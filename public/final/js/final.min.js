var config={apiKey:"AIzaSyCf9mEv6fjrsEk9ZryrfGZv-ygiBhpVt1Y",authDomain:"gamedex-2d485.firebaseapp.com",databaseURL:"https://gamedex-2d485.firebaseio.com",storageBucket:"gamedex-2d485.appspot.com",messagingSenderId:"1057082821990"},app=firebase.initializeApp(config),db=firebase.database(),storage=firebase.storage(),foo={};foo.initLoginPage=function(){firebase.auth().onAuthStateChanged(function(a){a&&window.location.replace("main.html")}),document.getElementById("login_submit").addEventListener("click",foo.handleLogin,!1),document.getElementById("login_register").addEventListener("click",foo.handleRegisterButton),document.getElementById("googleLogin").addEventListener("click",foo.handleGoogleLogin,!1)},foo.handleLogin=function(){var a=document.getElementById("login_email").value,b=document.getElementById("login_pass").value;firebase.auth().signInWithEmailAndPassword(a,b).catch(function(a){var b=a.code,c=a.message;"auth/wrong-password"===b?alert("Wrong password."):alert(c),console.log(a)})},foo.handleRegisterButton=function(){window.location.replace("register.html")},foo.handleGoogleLogin=function(){if(!firebase.auth().currentUser){var a=new firebase.auth.GoogleAuthProvider;a.addScope("https://www.googleapis.com/auth/plus.login"),firebase.auth().signInWithPopup(a).then(function(a){a.user}).catch(function(a){var b=a.code;a.message,a.email,a.credential;"auth/account-exists-with-different-credential"===b?alert("You have already signed up with a different auth provider for that email."):console.error(a)})}},foo.initRegistrationPage=function(){firebase.auth().onAuthStateChanged(function(a){a?window.location.replace("main.html"):(document.getElementById("register_submit").addEventListener("click",foo.handleRegistration,!1),document.getElementById("register_cancel").addEventListener("click",foo.handleRegisterCancel,!1))})},foo.handleRegistration=function(){foo.createFirebaseUser(),firebase.auth().onAuthStateChanged(function(a){a&&(foo.createCustomUser(),window.location.replace("main.html"))})},foo.createFirebaseUser=function(){var a=document.getElementById("register_email").value,b=document.getElementById("register_password").value;firebase.auth().createUserWithEmailAndPassword(a,b).catch(function(a){var b=a.code,c=a.message;"auth/weak-password"==b?alert("The password is too weak."):alert(c),console.log(a)})},foo.createCustomUser=function(){var a=document.getElementById("register_displayName").value,b=firebase.database().ref("users/"+firebase.auth().currentUser.uid);b.set({display_name:a})},foo.handleRegisterCancel=function(){window.location.replace("index.html")},foo.initMainPage=function(){firebase.auth().onAuthStateChanged(function(a){a?(foo.loadDisplayName(a),document.getElementById("logout").addEventListener("click",foo.handleLogout,!1),document.getElementById("add_game").addEventListener("click",foo.handleAddGameButton,!1),document.getElementById("game_cancel").addEventListener("click",foo.handleGameCancelButton,!1),foo.startFirebaseQuery()):window.location.replace("index.html")})},foo.loadDisplayName=function(a){if(a)if(a.displayName){var b=a.displayName.slice(-1);"s"!=b?document.getElementById("displayName").innerHTML=a.displayName+"'s GameDex":document.getElementById("displayName").innerHTML=a.displayName+"' GameDex"}else{var c="users/"+firebase.auth().currentUser.uid,d=firebase.database().ref(c);d.once("value").then(function(a){document.getElementById("displayName").innerHTML=a.child("display_name").val()+"'s GameDex";var b=a.child("display_name").val().slice(-1);"s"!=b?document.getElementById("displayName").innerHTML=a.child("display_name").val()+"'s GameDex":document.getElementById("displayName").innerHTML=a.child("display_name").val()+"' GameDex"})}},foo.handleLogout=function(){firebase.auth().currentUser&&(firebase.auth().signOut(),window.location.replace("index.html"))},foo.handleAddGameButton=function(){foo.openForm(),document.getElementById("game_submit").addEventListener("click",foo.handleNewGameSubmit,!1),document.getElementById("game_image").setAttribute("required",!0),document.getElementById("form_type_label").innerText="Add a new game."},foo.handleNewGameSubmit=function(){var a=document.getElementById("game_image").files[0],b=document.getElementById("game_title").value,c=document.getElementById("game_desc").value,d=document.getElementById("game_reldate").value,e=document.getElementById("game_price").value,f=document.getElementById("game_system"),g=f.options[f.selectedIndex].text,h=document.getElementById("game_genre").value;a&&b&&c&&d&&e&&g&&h&&(foo.writeGameData(a,b,c,d,e,g,h),foo.closeForm())},foo.writeGameData=function(a,b,c,d,e,f,g){var h=firebase.auth().currentUser.uid,i=h+Date.now()+".jpg",j=firebase.storage().ref(),k={contentType:"image/jpeg"},l=j.child(i).put(a,k);l.on(firebase.storage.TaskEvent.STATE_CHANGED,function(a){var b=a.bytesTransferred/a.totalBytes*100;switch(console.log("Upload is "+b+"% done"),a.state){case firebase.storage.TaskState.PAUSED:console.log("Upload is paused");break;case firebase.storage.TaskState.RUNNING:console.log("Upload is running")}},function(a){console.log("An error occured: "+a.code)},function(){var a=foo.getUserGameLibraryRef(),h=a.push();h.set({imageURL:i,title:b,desc:c,reldate:d,price:e,system:f,genre:g})})},foo.handleEditGameButton=function(a){foo.openForm(),document.getElementById("game_submit").addEventListener("click",foo.handleEditGameSubmit,!1),document.getElementById("game_image").removeAttribute("required"),document.getElementById("form_type_label").innerText="Edit this game.";var b=foo.getUserGameLibraryRef();b.child(a).once("value").then(function(b){var c=b.child("imageURL").val();document.getElementById("oldImageURL").value=c,document.getElementById("game_key").value=a,document.getElementById("game_title").value=b.child("title").val(),document.getElementById("game_desc").value=b.child("desc").val(),document.getElementById("game_reldate").value=b.child("reldate").val(),document.getElementById("game_price").value=b.child("price").val();var d=document.getElementById("game_system");d.options[d.selectedIndex].text=b.child("system").val(),document.getElementById("game_genre").value=b.child("genre").val(),foo.loadImageEditPage(a,c)})},foo.loadImageEditPage=function(a,b){var c=firebase.storage().ref();c.child(b).getDownloadURL().then(function(a){var b=document.getElementById("img_container");b.innerHTML='<img id="imgEdit" src="'+a+'">'}).catch(function(a){console.log("Error loading image: "+a.code)})},foo.handleEditGameSubmit=function(){var a=document.getElementById("game_key").value,b=document.getElementById("oldImageURL").value,c=document.getElementById("game_image").files[0],d=document.getElementById("game_title").value,e=document.getElementById("game_desc").value,f=document.getElementById("game_reldate").value,g=document.getElementById("game_price").value,h=document.getElementById("game_system"),i=h.options[h.selectedIndex].text,j=document.getElementById("game_genre").value;d&&e&&f&&g&&i&&j&&(foo.editGameData(a,b,c,d,e,f,g,i,j),foo.closeForm())},foo.editGameData=function(a,b,c,d,e,f,g,h,i){var j=b;if(c){var k=firebase.auth().currentUser.uid;j=k+Date.now()+".jpg";var l=firebase.storage().ref(),m={contentType:"image/jpeg"},n=l.child(j).put(c,m);n.on(firebase.storage.TaskEvent.STATE_CHANGED,function(a){var b=a.bytesTransferred/a.totalBytes*100;switch(console.log("Upload is "+b+"% done"),a.state){case firebase.storage.TaskState.PAUSED:console.log("Upload is paused");break;case firebase.storage.TaskState.RUNNING:console.log("Upload is running")}},function(a){console.log("An error occured: "+a.code)},function(){var c=l.child(b);c.delete().catch(function(a){console.log("Error deleting file.")});var k=foo.getUserGameLibraryRef();k.child(a).set({title:d,imageURL:j,desc:e,reldate:f,price:g,system:h,genre:i})})}},foo.clearImage=function(){document.getElementById("img_container").style.display="none"},foo.openForm=function(){var a=document.getElementById("section_form"),b=document.getElementById("section_library");a.style.display="inline",b.style.display="none",document.getElementById("img_container").style.display="block"},foo.closeForm=function(){document.getElementById("game_submit").removeEventListener("click",foo.handleEditGameSubmit,!1),document.getElementById("game_submit").removeEventListener("click",foo.handleNewGameSubmit,!1),document.getElementById("game_key").value="",document.getElementById("game_image").value="",document.getElementById("game_title").value="",document.getElementById("game_desc").value="",document.getElementById("game_desc").value="",document.getElementById("game_reldate").value="",document.getElementById("game_price").value="";var a=document.getElementById("game_system");a.options[a.selectedIndex].value=4,document.getElementById("game_genre").value="";var b=document.getElementById("section_form"),c=document.getElementById("section_library");b.style.display="none",c.style.display="inline"},foo.handleGameCancelButton=function(){foo.closeForm()},foo.startFirebaseQuery=function(){var a=foo.getUserGameLibraryRef(),b=document.getElementById("game_library");foo.fetchUserGameLibrary(a,b)},foo.fetchUserGameLibrary=function(a,b){a.on("child_added",function(a){var c=a.key,d=a.val().imageURL,e=a.val().title,f=a.val().desc,g=a.val().reldate,h=a.val().price,i=a.val().system,j=a.val().genre,k=document.createElement("tr");k.setAttribute("id","game_"+c),k.innerHTML=foo.createGameEntry(c,e,f,g,h,i,j);var l=b.getElementsByClassName("game_entries")[0];l.append(k),foo.loadImageListView(c,d)}),a.on("child_changed",function(a){var b=a.key;document.getElementById("game_title_view_game_"+b).innerText=a.val().title,document.getElementById("game_desc_view_game_"+b).innerText=a.val().desc,document.getElementById("game_reldate_view_game_"+b).innerText=a.val().reldate,document.getElementById("game_price_view_game_"+b).innerText=a.val().price,document.getElementById("game_system_view_game_"+b).innerText=a.val().system,document.getElementById("game_genre_view_game_"+b).innerText=a.val().genre,foo.loadImageListView(b,a.val().imageURL)}),a.on("child_removed",function(a){var b=a.key,c=document.getElementById("game_"+b);c.parentNode.removeChild(c)})},foo.createGameEntry=function(a,b,c,d,e,f,g){var h='<td id="game_image_view_game_'+a+'"><img id="game_image_element'+a+'"></td><td id="game_title_view_game_'+a+'">'+b+'</td><td id="game_desc_view_game_'+a+'">'+c+'</td><td id="game_reldate_view_game_'+a+'">'+d+'</td><td id="game_price_view_game_'+a+'">'+e+'</td><td id="game_system_view_game_'+a+'">'+f+'</td><td id="game_genre_view_game_'+a+'">'+g+'</td><td><button type="button" onclick="foo.handleEditGameButton(\''+a+'\')">Edit</button></td><td><button type="button" onclick="foo.handleRemoveGameButton(\''+a+"')\">Remove</button></td></tr></div>";return h},foo.loadImageListView=function(a,b){var c=firebase.storage().ref();c.child(b).getDownloadURL().then(function(b){var c=document.getElementById("game_image_view_game_"+a);c.innerHTML='<img src="'+b+'">'}).catch(function(a){window.location.replace("main.html")})},foo.handleRemoveGameButton=function(a){confirm("Remove game?")&&foo.removeGameData(a)},foo.removeGameData=function(a){var b=foo.getUserGameLibraryRef();b.child(a).once("value").then(function(a){var b=a.child("imageURL").val(),c=firebase.storage().ref(),d=c.child(b);d.delete().catch(function(a){console.log("Error deleting file.")})}),b.child(a).remove()},foo.getUserGameLibraryRef=function(){var a=firebase.auth().currentUser.uid,b="users/"+a+"/games";return firebase.database().ref(b)};
